<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <title>wuhangyu的聊天室</title>
    <script src="/static/libs/js/jquery/2.0.0/jquery.min.js"></script>
    <link href="/static/libs/css/bootstrap/3.3.6/bootstrap.min.css" rel="stylesheet">
    <script src="/static/libs/js/bootstrap/3.3.6/bootstrap.min.js"></script>

</head>
<body>
<div class="container">
    <div id="window">
        <div class="panel panel-info">
            <div class="panel-heading">
                聊天室
            </div>
            <div class="content">
                <div class="left">
                    <div id="personal">个人形象区</div>
                    <img src="/static/app/image/3.jpg" width="100px" height="100px">
                </div>
                <div class="receive" style="height: 400px;width: 500px;">

                </div>
                <div class="send">
                    <textarea name="send_content" id="send_content" required> </textarea>
                    <button  id="btn" >发送</button>
                </div>
            </div>

        </div>
    </div>
</div>
<script>
    // 创建一个websocket长连接对象
    var _websocket= new WebSocket('ws://10.70.21.68:8000/chat')
    //发送消息
    $('#btn').click(function(){
        //获取消息内容
        $msg=$('#send_content').val();
        //发送消息
        _websocket.send($msg);
         $("#msg").val('');
    })
    //接收消息,当消息更新时自动触发
    _websocket.onmessage=function(e){
        console.log(e)
        var $content=e.data;
        //重构date的Format属性
        Date.prototype.Format = function (fmt) {
    var o = {
        "M+": this.getMonth() + 1, //月份
        "d+": this.getDate(), //日
        "H+": this.getHours(), //小时
        "m+": this.getMinutes(), //分
        "s+": this.getSeconds(), //秒
        "q+": Math.floor((this.getMonth() + 3) / 3), //季度
        "S": this.getMilliseconds() //毫秒
    };
    if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
    for (var k in o)
    if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
    return fmt;
}
        var date=new Date();
        var $time=date.Format("yyyy年MM月dd HH:mm:ss");
        var $p1=$('<p>').text($content);
        var $p2=$('<p>').text($time);
        $('.receive').append($p2).append($p1)

    }

</script>
</body>
</html>
